"use strict";var app=angular.module("app",["ngRoute","ui.bootstrap","pascalprecht.translate","ngCookies","ui.select"]);app.constant("LOCALES",{locales:[{key:"en",value:"English","form-validation-rules":{"postcode-regexp":"[a-zA-Z]{2}\\d{1,2}\\s*\\d[a-zA-Z]{2}$","phone-min-length":8}},{key:"de",value:"Deutsch","form-validation-rules":{"postcode-regexp":"(?!01000|99999)(0[1-9]\\d{3}|[1-9]\\d{4})$","phone-min-length":10}},{key:"es",value:"Español","form-validation-rules":{"postcode-regexp":"[a-zA-Z]{2}\\d{1,2}\\s*\\d[a-zA-Z]{2}$"}},{key:"fr",value:"Français","form-validation-rules":{"postcode-regexp":"(?!01000|99999)(0[1-9]\\d{3}|[1-9]\\d{4})$"}},{key:"it",value:"Italiano","form-validation-rules":{"postcode-regexp":"[a-zA-Z]{2}\\d{1,2}\\s*\\d[a-zA-Z]{2}$"}},{key:"ja",value:"日本語","form-validation-rules":{"postcode-regexp":"(?!01000|99999)(0[1-9]\\d{3}|[1-9]\\d{4})$"}}],preferredLocale:"en"}),app.config(["$routeProvider","$httpProvider",function(e,l){e.when("/:guid",{controller:"RegistrationController",templateUrl:"app/components/registration/registration.view.html",parameters:{guid:null}}).otherwise({redirectTo:"/"})}]),app.config(["$translateProvider","LOCALES",function(e,l){e.useMissingTranslationHandlerLog(),e.useStaticFilesLoader({prefix:"assets/locale/",suffix:".json"}),e.preferredLanguage(l.preferredLocale),e.useLocalStorage(),e.useSanitizeValueStrategy("sce")}]),app.run(["$rootScope",function(e){e.$on("$routeChangeStart",function(l,i,n){e.loadingView=!0}),e.$on("$routeChangeSuccess",function(l,i,n){e.loadingView=!1,$("#mainContainer").animate({scrollTop:0},0)})}]),angular.module("app").service("ApiService",["$http","$q",function(e,l){var i=function(e,l){void 0!==l&&l.reject(e)};this.getGuid=function(n){var r=l.defer();return e.get("/registration-api/registration/"+n).then(function(e){200===e.status||201===e.status?r.resolve(e.data):r.reject(e)},function(e){i(e,r)}),r.promise},this.createRegistration=function(n){var r=l.defer();return e.post("/registration-api/registration",n).then(function(e){200===e.status||201===e.status?r.resolve(e.data):r.reject(e)},function(e){i(e,r)}),r.promise}}]),angular.module("app").controller("RegistrationController",["$scope","$rootScope","LOCALES","$translate","ApiService","$uibModal","$window","$location","$routeParams",function(e,l,i,n,r,s,t,o,a){function u(e){for(var l=i.locales,n=0;n<l.length;n++)if(l[n].key==e||l[n].value==e)return l[n]["form-validation-rules"]["postcode-regexp"]}function d(l){""!=l?(l.col_users.length>0?(e.users=l.col_users.map(function(l,i){var r,s;if(l.requested_role)for(var t=0;t<e.userRoles.length;t++)e.userRoles[t].value==l.requested_role&&(r=e.userRoles[t].label);if(l.title)for(t=0;t<e.titles.length;t++)e.titles[t].value==l.title&&(s=e.titles[t].label);return{number:i+1,id:l.id||"",UserInfoNewColId:l.new_col_id,selectedRole:l.requested_role||"",translatedSelectedRoleLabel:l.requested_role?n.instant(r).toString():"",UserInfoTitle:l.title?{value:l.title}:{value:""},translatedUserInfoTitleLabel:l.title?n.instant(s).toString():"",UserInfoFullNameAdmin:l.forename+" "+l.surname||"",UserInfoTelephone:l.telephone||"",UserColtOnlinePortalDisplayLanguage:{value:l.language,label:l.language},UserInfoColtOnlineUserIDAdmin:l.existing_col_id||"",UserInfoEmail:l.email||""}}),e.latestUserNumber=e.users.length+1):(e.users=[{number:1,UserInfoColtOnlineUserIDAdmin:"",selectedRole:"Full",UserInfoFullNameAdmin:"",UserInfoTitle:{value:""},UserInfoEmail:"",UserInfoTelephone:"",UserColtOnlinePortalDisplayLanguage:{value:""},detailsComplete:!1}],e.latestUserNumber=1),e.OCN=l.ocn||"",e.ContactName=l.primary_contact_name||"",e.ContactPhoneNumber=l.primary_contact_tel||"",e.ContactEmail=l.primary_contact_email||"",e.CompanyName=l.company_name||"",e.VATNumber=l.vat_number||"",e.PremisesNumber=l.primary_contact_email||"",e.CompanyStreetName=l.address_street||"",e.CompanyPostCode=l.address_postcode||"",e.CompanyCity=l.address_city||"",e.CompanyProvince=l.address_county||"",e.RefBCN=l.reference_bcn||"",e.OCNNumberExists=l.ocn.length>0,e.NewBillingDetails=!l.reference_bcn,e.detectCurrentFormSection()):(e.ContactDetailsComplete=!1,e.CompanyDetailsComplete=!1,e.NewBillingDetails=!1,e.NewBillingDetailsComplete=!1,e.LegalNoticeAccepted=!1,e.FormSubmissionAttempted=!1,e.latestUserNumber=1),e.selectedVals={CompanyCountry:{country:l.address_country||""},CompanyLanguage:{label:l.language||""}},e.billingAddressFields={BillingPremiseNumber:{required:!0,value:l.billing_address_premise_no||""},BillingStreetName:{required:!0,value:l.billing_address_street||""},BillingPostCode:{required:!0,value:l.billing_address_postcode||""},BillingCity:{required:!0,value:l.billing_address_city||""},BillingProvince:{required:!0,value:l.billing_address_county||""},BankName:{required:!0,value:l.billing_bank_name||""},AccountName:{required:!0,value:l.billing_account_name||""},PaymentMethod:{required:!0,value:l.billing_payment_method||""},BranchName:{required:!0,value:l.billing_branch_name||""},SortCode:{required:!0,value:l.billing_sort_code||""},IBAN:{required:!0,value:l.billing_iban||""},BIC:{required:!0,value:l.billing_bic||""},BillingCountry:{required:!0,value:l.billing_address_country||"",country:l.billing_address_country||""}},e.invoiceDetailsFields={InvoiceTitle:{required:!0,value:l.invoice_title||""},InvoiceName:{required:!0,value:l.invoice_contact_name||""},PO:{required:!0,value:l.invoice_po_number||""},InvoiceEmailAddress:{required:!0,value:l.invoice_email_address||""},CustomerReference:{required:!0,value:l.invoice_customer_ref||""},InvoiceTelephoneNumber:{required:!0,value:l.invoice_tel||""},Currency:{required:!0,value:l.invoice_currency||""},InvoiceLanguage:{required:!0,value:l.invoice_language||""}}}this._apiService=r,e.detectCurrentFormSection=function(){""==e.OCN?e.currentFormSection=1:e.ContactDetailsComplete?e.CompanyDetailsComplete?e.NewBillingDetails&&!e.NewBillingDetailsComplete&&0==e.RefBCN.length||!e.NewBillingDetails&&(0==e.registrationForm.ReferenceBCN.length||e.registrationForm.ReferenceBCN.$invalid)?e.currentFormSection=4:e.registrationForm.InvoiceEmailAddress.$invalid||e.registrationForm.InvoiceTelephoneNumber.$invalid?e.currentFormSection=5:0==e.users[e.users.length-1].detailsComplete?e.currentFormSection=6:e.LegalNoticeAccepted||(e.currentFormSection=7):e.currentFormSection=3:e.currentFormSection=2},e.showFormModal=function(e){var l,i;"success"==e?(l=n.instant("registration.popup-labels.success-header").toString(),i=n.instant("registration.popup-labels.success-message").toString()):"save"==e?(l=n.instant("registration.popup-labels.save-success-header").toString(),i=n.instant("registration.popup-labels.save-success-message").toString()):"privacy-link"==e?(l=n.instant("registration.form-labels.legal-notice-header").toString(),i=n.instant("registration.popup-labels.legal-notice-message").toString()):"error"==e&&(l=n.instant("registration.popup-labels.error-header").toString(),i=n.instant("registration.popup-labels.error-message").toString());s.open({backdrop:"static",animation:!0,component:"registrationSubmissionReceivedModalComponent",resolve:{messages:function(){return{Title:l,Message:i}}}})},e.$watch("[ContactName, ContactPhoneNumber, ContactEmail]",function(l,i,n){var r=l[0],s=l[1],t=l[2];e.ContactDetailsComplete=""!=r&&void 0!==r&&""!=s&&void 0!==s&&""!=t&&void 0!==t}),e.$watch("[CompanyName, selectedVals.CompanyCountry, selectedVals.CompanyLanguage, PremisesNumber, CompanyStreetName, CompanyPostCode, CompanyProvince, VATNumber]",function(l,i,n){var r=l[0],s=l[1],t=l[2],o=l[3],a=l[4],u=l[5],d=l[6],c=l[7];e.OCNNumberExists||""==r||void 0===r||""==s||void 0===s||""==t||void 0===t||""==o||void 0===o||""==a||void 0===a||""==u||void 0===u||""==d||void 0===d||""==c||void 0===c?e.OCNNumberExists&&""!=s&&void 0!==s&&""!=t&&void 0!==t?n.CompanyDetailsComplete=!0:n.CompanyDetailsComplete=!1:n.CompanyDetailsComplete=!0}),e.$watch("billingAddressFields",function(l,i,n){var r=!0;for(var s in e.billingAddressFields)if("selectedVals"!=s){var t=e.billingAddressFields[s];1!=t.required||""!=t.value&&void 0!==t.value||(r=!1)}e.NewBillingDetailsComplete=r},!0),e.$watch("selectedVals.CompanyCountry",function(e,l,i){e!==l&&""!=e&&(i.companyPostCodeRegExp=u(e.label),i.billingPostCodeRegExp=u(e.label),i.billingAddressFields.BillingCountry.value=e.label,i.billingAddressFields.BillingCountry.country=e.country)}),e.$watch("billingAddressFields.BillingCountry",function(e,l,i){e!==l&&""!=e&&(i.billingPostCodeRegExp=u(e.label))}),e.$watch("OCN",function(l,i,n){if(l===i)return!1;e.OCNNumberExists=void 0!==l&&l.length>0}),e.$watch("CopyCompanyAddress",function(l,i,n){if(l===i)return!1;1==l&&(e.billingAddressFields.BillingPremiseNumber.value=void 0===e.PremisesNumber?"":e.PremisesNumber,e.billingAddressFields.BillingStreetName.value=void 0===e.CompanyStreetName?"":e.CompanyStreetName,e.billingAddressFields.BillingPostCode.value=void 0===e.CompanyPostCode?"":e.CompanyPostCode,e.billingAddressFields.BillingCity.value=void 0===e.CompanyCity?"":e.CompanyCity,e.billingAddressFields.BillingProvince.value=void 0===e.CompanyProvince?"":e.CompanyProvince,e.billingAddressFields.BillingCountry.value=null===e.selectedVals.CompanyCountry?"":e.selectedVals.CompanyCountry.country,e.billingAddressFields.BillingCountry.country=null===e.selectedVals.CompanyCountry?"":e.selectedVals.CompanyCountry.country)}),e.toggleNewBillingBool=function(l){e.NewBillingDetails=l},e.addUser=function(){if(e.users.length<5){var l=e.users.length+1;e.users.push({number:l,UserInfoColtOnlineUserIDAdmin:"",UserInfoFullNameAdmin:"",UserInfoTitle:{value:""},UserInfoEmail:"",UserInfoTelephone:"",UserColtOnlinePortalDisplayLanguage:{value:""},SelectedRole:"",detailsComplete:!1}),e.latestUserNumber+=1}},e.removeUser=function(l){for(var i=null,n=0;n<e.users.length;n++)e.users[n].number==l.number&&(i=n);e.users.splice(i,1);for(n=0;n<e.users.length;n++)e.users[n].number=n+1;e.latestUserNumber-=1},e.selectUserRole=function(l){for(var i=l.selectedRole.value,r=0;r<e.userRoles.length;r++)e.userRoles[r].value==i&&(l.translatedSelectedRoleLabel=n.instant(e.userRoles[r].label).toString())},e.selectUserTitle=function(l){for(var i=l.UserInfoTitle.value,r=0;r<e.titles.length;r++)e.titles[r].value==i&&(l.translatedUserInfoTitleLabel=n.instant(e.titles[r].label).toString())},e.processForm=function(l,i){if(e.FormSubmissionAttempted="save"!=i,l.$valid||"submit"!=i){var n=e.users.map(function(e){e.UserInfoColtOnlineUserIDAdmin.length,e.selectedRole,e.UserInfoTitle.value,e.UserInfoFullNameAdmin.split(" ")[0],e.UserInfoFullNameAdmin.split(" ").length>1&&e.UserInfoFullNameAdmin.split(" ")[e.UserInfoFullNameAdmin.split(" ").length-1],e.UserInfoTelephone,e.UserColtOnlinePortalDisplayLanguage.value,e.UserInfoColtOnlineUserIDAdmin,e.UserInfoEmail}),s={colt_creator:"DUMMY VAL",ocn:e.OCN||"",primary_contact_name:e.ContactName||"",primary_contact_tel:e.ContactPhoneNumber||"",primary_contact_email:e.ContactEmail||"",company_name:e.CompanyName||"",vat_number:e.VATNumber||"",address_premise_no:e.PremisesNumber||"",address_street:e.CompanyStreetName||"",address_postcode:e.CompanyPostCode||"",address_city:e.CompanyCity||"",address_county:e.CompanyProvince||"",address_country:e.selectedVals.CompanyCountry.country||"",language:e.selectedVals.CompanyLanguage.value||"",reference_bcn:e.RefBCN||"",invoice_title:e.invoiceDetailsFields.InvoiceTitle.value||"",invoice_contact_name:e.invoiceDetailsFields.InvoiceName.value||"",invoice_po_number:e.invoiceDetailsFields.PO.value||"",invoice_email_address:e.invoiceDetailsFields.InvoiceEmailAddress.value||"",invoice_customer_ref:e.invoiceDetailsFields.CustomerReference.value||"",invoice_tel:e.invoiceDetailsFields.InvoiceTelephoneNumber.value||"",invoice_currency:e.invoiceDetailsFields.Currency.value||"",invoice_language:e.invoiceDetailsFields.InvoiceLanguage.value||"",billing_address_premise_no:e.billingAddressFields.BillingPremiseNumber.value||"",billing_address_street:e.billingAddressFields.BillingStreetName.value||"",billing_address_postcode:e.billingAddressFields.BillingPostCode.value||"",billing_address_city:e.billingAddressFields.BillingCity.value||"",billing_address_county:e.billingAddressFields.BillingProvince.value||"",billing_address_country:e.billingAddressFields.BillingCountry.country||"",billing_bank_name:e.billingAddressFields.BankName.value||"",billing_account_name:e.billingAddressFields.AccountName.value||"",billing_payment_method:e.billingAddressFields.PaymentMethod.value||"",billing_branch_name:e.billingAddressFields.BranchName.value||"",billing_sort_code:e.billingAddressFields.SortCode.value||"",billing_iban:e.billingAddressFields.IBAN.value||"",billing_bic:e.billingAddressFields.BIC.value||"",last_updated:"",col_users:n};r.createRegistration(s).then(function(l){"submit"==i?(e.OCN="",e.ContactName="",e.ContactPhoneNumber="",e.ContactEmail="",e.CompanyName="",e.VATNumber="",e.PremisesNumber="",e.CompanyStreetName="",e.CompanyPostCode="",e.CompanyCity="",e.CompanyProvince="",e.CompanyCountry=null,e.CompanyLanguage=null,d(""),e.showFormModal("success")):e.showFormModal("save-success")},function(l){e.showFormModal("error"),t.scrollTo(0,0)})}else t.scrollTo(0,0),e.detectCurrentFormSection()},e.logo="assets/images/colt-logo-light@2x.png",e.loading=!1,e.titles=[{label:"registration.form-labels.title-sir",value:"Sir"},{label:"registration.form-labels.title-mr",value:"Mr"},{label:"registration.form-labels.title-mrs",value:"Mrs"},{label:"registration.form-labels.title-miss",value:"Miss"},{label:"registration.form-labels.title-ms",value:"Ms"}],e.userRoles=[{label:"registration.form-labels.full",description:"registration.form-labels.full-role-description",value:"Full",selected:!0},{label:"registration.form-labels.primary",description:"registration.form-labels.primary-role-description",value:"Primary"},{label:"registration.form-labels.flex",description:"registration.form-labels.flex-role-description",value:"Flex"},{label:"registration.form-labels.read-only",description:"registration.form-labels.read-only-role-description",value:"Read Only"}],e.languages=[{label:"English",value:"English",country:"England",selected:!0},{label:"Deutsch",value:"German",country:"Germany"},{label:"Español",value:"Spanish",country:"Spain"},{label:"Français",value:"French",country:"France"},{label:"Italiano",value:"Italian",country:"Italy"},{label:"日本語",value:"Japanese",country:"Japan"}],e.currencies=[{label:"GBP"},{label:"EUR"},{label:"JPY"}],e.postCodeRegExp=u(i.preferredLocale),e.companyPostCodeRegExp=u(i.preferredLocale),e.billingPostCodeRegExp=u(i.preferredLocale),e.latestUserNumber=1,e.currentFormSection=1,e.emailRegExp='(([^<>()\\[\\]\\.,;:\\s@"]+(\\.[^<>()\\[\\]\\.,;:\\s@"]+)*)|(".+"))@(([^<>()[\\]\\.,;:\\s@"]+\\.)+[^<>()[\\]\\.,;:\\s@"]{2,})$',e.phoneNumRegExp="(?=.*\\d)[\\d ]+$",e.refBCNRegExp=/^[0-9]{6}$/,e.guid=a.guid,r.getGuid(e.guid).then(function(e){console.log(e),d(e)},function(e){})}]),angular.module("app").controller("SystemUserController",["$scope","$rootScope",function(e,l){e.$watch("[user.number, user.selectedRole, user.UserInfoTitle, user.UserInfoFullNameAdmin, user.UserInfoTelephone, user.UserInfoEmail, user.UserInfoColtOnlineUserIDAdmin, user.UserColtOnlinePortalDisplayLanguage]",function(l,i,n){for(var r=0;r<e.users.length;r++)e.users[r].number==l[0]&&(null!=e.users[r].selectedRole&&null!=e.users[r].UserInfoTitle&&""!=e.users[r].UserInfoFullNameAdmin&&""!=e.users[r].UserInfoTelephone&&""!=e.users[r].UserInfoEmail&&void 0!==e.users[r].UserInfoEmail&&""!=e.users[r].UserInfoColtOnlineUserIDAdmin&&null!=e.users[r].UserColtOnlinePortalDisplayLanguage?e.users[r].detailsComplete=!0:""!=e.users[r].UserInfoColtOnlineUserIDAdmin&&""!=e.users[r].UserInfoEmail&&void 0!==e.users[r].UserInfoEmail?e.users[r].detailsComplete=!0:e.users[r].detailsComplete=!1)})}]),angular.module("app").component("registrationSubmissionReceivedModalComponent",{templateUrl:"app/components/shared/modals/registration-submission-received/registration-submission-received-modal-dialog.view.html",bindings:{resolve:"<",close:"&"},controller:function(){var e=this;e.$onInit=function(){e.translatedModalMessages={Title:e.resolve.messages.Title,Message:e.resolve.messages.Message}},e.ok=function(){e.close()}}});